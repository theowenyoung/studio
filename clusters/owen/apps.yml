# bun-hello 应用
---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: bun-hello
  namespace: flux-system
spec:
  interval: 5m0s
  sourceRef:
    kind: GitRepository
    name: flux-system  # 这个名字需要和平台创建的 GitRepository 一致
  path: ./k8s/base/web-app
  prune: true
  wait: false
  timeout: 10m
  postBuild:
    substitute:
      APP_NAME: "bun-hello"
      APP_IMAGE: "912951144733.dkr.ecr.us-west-2.amazonaws.com/bun-hello"
      APP_TAG: "20250817"
      APP_HOST: "bun-hello.owenyoung.com"
      APP_REPLICAS: "2"
      APP_NAMESPACE: "default"
      APP_PORT: "3000"
---
# 新的 hello-world 应用
apiVersion: kustomize.toolkit.fluxcd.io/v1beta2
kind: Kustomization
metadata:
  name: hello-world
  namespace: flux-system
spec:
  interval: 5m0s
  sourceRef:
    kind: GitRepository
    name: flux-system
  path: ./k8s/base/web-app
  prune: true
  wait: true
  timeout: 10m
  postBuild:
    substitute:
      APP_NAME: "hello-world"
      APP_IMAGE: "912951144733.dkr.ecr.us-west-2.amazonaws.com/nginx-test"                    # 使用公开的 nginx 镜像
      APP_TAG: "latest"
      APP_HOST: "demo-hello.owenyoung.com"
      APP_REPLICAS: "2"
      APP_NAMESPACE: "default"
