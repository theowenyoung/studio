# 全局配置
{
    email {{ admin_email }}
    # 启用管理API
    admin 0.0.0.0:2019
}

# 主域名配置
{{ app1_domain }} {
    # 静态文件服务
    handle /static/* {
        root * /srv/public
        file_server
    }
    
    # 上传文件服务
    handle /uploads/* {
        root * /srv
        file_server
    }
    
    # API请求代理到应用
    handle /api/* {
        reverse_proxy app:{{ app_port }} {
            health_uri /health
            health_interval 30s
            health_timeout 10s
        }
    }
    
    # 健康检查
    handle /health {
        reverse_proxy app:{{ app_port }}
    }
    
    # 默认路由，代理到应用
    handle {
        reverse_proxy app:{{ app_port }} {
            health_uri /health
            health_interval 30s
            health_timeout 10s
        }
    }
    
    # 启用压缩
    encode gzip
    
    # 日志配置
    log {
        output file /data/logs/{{ app1_domain }}.log {
            roll_size 100MB
            roll_keep 5
        }
        format json
        level INFO
    }
    
    # 安全头
    header {
        # 安全头配置
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        
        # 移除服务器信息
        -Server
    }
}
